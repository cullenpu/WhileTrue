FROM node:14

ARG PORT
ARG MAGIC_SECRET_KEY
ARG REACT_APP_MAGIC_PUBLISHABLE_KEY
ARG JWT_SECRET
ARG DATABASE_URL
ARG OPENAI_API_KEY
ARG INGESTION_KEY

WORKDIR /main

COPY . .

RUN npm run install-all

RUN npm run build

RUN npm run migrate

ENV NODE_ENV production

EXPOSE $PORT

CMD ["npm", "run", "start"]